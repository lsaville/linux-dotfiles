#!/bin/bash
# Like `tmux select-pane`, but sends a `<C-h/j/k/l>` keystroke if Vim is
# running in the current pane, or only one pane exists.

set -e

cmd="$(tmux display -p '#{pane_current_command}')"
cmd="$(basename "$cmd" | tr A-Z a-z)"
pane_count="$(printf %d $(tmux list-panes | wc -l))"

#echo $cmd

# 2022-03-26
# removing %m... seems to truncate cmd, not able to quickly find info about it..
# not shocking... bash amiright
# looked more and it deletes the 'm' off 'vim'
# https://www.gnu.org/software/bash/manual/bash.html#Shell-Parameter-Expansion

# og
# if [[ "${cmd%m}" = "vi" || "${cmd%m}" = "mosh-client" ||($pane_count = 1) ]]; then
#   direction="$(echo "${1#-}" | tr 'lLDUR' '\\hjkl')"
#   # forward the keystroke to Vim
#   tmux send-keys "C-$direction"
# else
#   tmux select-pane "$@"
# fi

if [[ "$cmd" = n?vim || ($pane_count = 1) ]]; then
  direction="$(echo "${1#-}" | tr 'lLDUR' '\\hjkl')"
  # forward the keystroke to Vim
  tmux send-keys "C-$direction"
else
  tmux select-pane "$@"
fi
